<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=HandheldFriendly content="True"><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=generator content="Hugo 0.96.0"><link rel="shortcut icon" href=https://cdn.jsdelivr.net/gh/dsrkafuu/dsr-cdn-main@1/images/favicons/dsrca.ico><title>A simple example of using docker container to realize the grpc client and server communication - LMJW Blog</title><meta name=author content="LMJW"><meta name=description content="A minimal Hugo theme with nice theme color."><meta name=keywords content="Docker,grpc,network"><meta property="og:title" content="A simple example of using docker container to realize the grpc client and server communication"><meta name=twitter:title content="A simple example of using docker container to realize the grpc client and server communication"><meta property="og:type" content="article"><meta property="og:url" content="https://lmjw.github.io/post/2017-12-26-docker-grpc-network/"><meta property="og:description" content="First, build a docker container that contains all required packages. In this example, I choose ubuntu:bionic as the basic image, and I installed other packages onto it.
FROM ubuntu:bionic RUN apt-get update RUN apt-get install python3 -y RUN apt-get install python3-pip -y RUN pip3 install grpcio ADD app /app/ EXPOSE 22222  The Dockerfile is shown above. In the app file, it contains 4 files. They are:
 client.py, server.py, test_pb2.py, test_pb2_grpc.py
 test_pb2.py and test_pb2_grpc.py is generated by compiling the test.protofile. The content for test.proto is shown below.
syntax = &#34;proto3&#34;; package lmjwtest; // service, encode a plain text service EncodeService { // request a service of encode rpc GetEncode(plaintext) returns (encodetext) {} } message plaintext { string pttransactionID = 1; string ptproperties = 2; string ptsenderID = 3; } message encodetext { string enctransactionID = 1; string encproperties = 2; string encsenderID = 3; }  By using the grpcio-tools to compile the test."><meta name=twitter:description content="First, build a docker container that contains all required packages. In this example, I choose ubuntu:bionic as the basic image, and I installed other packages onto it.
FROM ubuntu:bionic RUN apt-get update RUN apt-get install python3 -y RUN apt-get install python3-pip -y RUN pip3 install grpcio ADD app /app/ EXPOSE 22222  The Dockerfile is shown above. In the app file, it contains 4 files. They are:
 client.py, server.py, test_pb2.py, test_pb2_grpc.py
 test_pb2.py and test_pb2_grpc.py is generated by compiling the test.protofile. The content for test.proto is shown below.
syntax = &#34;proto3&#34;; package lmjwtest; // service, encode a plain text service EncodeService { // request a service of encode rpc GetEncode(plaintext) returns (encodetext) {} } message plaintext { string pttransactionID = 1; string ptproperties = 2; string ptsenderID = 3; } message encodetext { string enctransactionID = 1; string encproperties = 2; string encsenderID = 3; }  By using the grpcio-tools to compile the test."><meta property="og:image" content="https://lmjw.github.io/img/og.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lmjw.github.io/img/og.png"><meta property="article:published_time" content="2017-12-26T00:00:00+00:00"><meta property="article:modified_time" content="2017-12-26T00:00:00+00:00"><style>@media(prefers-color-scheme:dark){body[data-theme=auto] img{filter:brightness(60%)}}body[data-theme=dark] img{filter:brightness(60%)}</style><link rel=stylesheet href=https://lmjw.github.io/assets/css/fuji.min.css></head><body data-theme=auto data-theme-auto=true><script data-cfasync=false>var fujiThemeData=localStorage.getItem("fuji_data-theme");fujiThemeData?fujiThemeData!=="auto"&&document.body.setAttribute("data-theme",fujiThemeData==="dark"?"dark":"light"):localStorage.setItem("fuji_data-theme","auto")</script><header><div class="container-lg clearfix"><div class="col-12 header"><a class=title-main href=https://lmjw.github.io/>LMJW Blog</a>
<span class=title-sub>My notes.</span></div></div></header><main><div class="container-lg clearfix"><div class="col-12 col-md-9 float-left content"><article><h2 class="post-item post-title"><a href=https://lmjw.github.io/post/2017-12-26-docker-grpc-network/>A simple example of using docker container to realize the grpc client and server communication</a></h2><div class="post-item post-meta"><span><i class="iconfont icon-today-sharp"></i>&nbsp;2017-12-26</span>
<span><i class="iconfont icon-file-tray-sharp"></i>&nbsp;657 words</span>
<span><i class="iconfont icon-time-sharp"></i>&nbsp;4 minutes</span>
<span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href=/tags/docker>Docker</a>&nbsp;<a href=/tags/grpc>grpc</a>&nbsp;<a href=/tags/network>network</a>&nbsp;</span></div><div class="post-content markdown-body"><p>First, build a docker container that contains all required packages. In this example, I choose ubuntu:bionic as the basic image, and I installed other packages onto it.</p><pre><code class=language-dockerfile>FROM ubuntu:bionic
RUN apt-get update
RUN apt-get install python3 -y
RUN apt-get install python3-pip -y
RUN pip3 install grpcio

ADD app /app/

EXPOSE 22222
</code></pre><p>The <code>Dockerfile</code> is shown above. In the <code>app</code> file, it contains 4 files. They are:</p><blockquote><p>client.py, server.py, test_pb2.py, test_pb2_grpc.py</p></blockquote><p><code>test_pb2.py</code> and <code>test_pb2_grpc.py</code> is generated by compiling the <code>test.proto</code>file. The content for <code>test.proto</code> is shown below.</p><pre><code class=language-protobuf>syntax = &quot;proto3&quot;;

package lmjwtest;

// service, encode a plain text 
service EncodeService {
    // request a service of encode
    rpc GetEncode(plaintext) returns (encodetext) {}
}


message plaintext {
    string pttransactionID = 1;
    string ptproperties = 2;
    string ptsenderID = 3;
}

message encodetext {
    string enctransactionID = 1;
    string encproperties = 2;
    string encsenderID = 3;
}
</code></pre><p>By using the <a href=https://grpc.io/docs/tutorials/basic/python.html target=_blank>grpcio-tools</a> to compile the <code>test.proto</code>file, we can get the <code>test_pb2.py</code> and <code>test_pb2_grpc.py</code> two files.</p><p>The compile command is:</p><pre><code class=language-bash>python3 -m grpc_tools.protoc -I. --python_out=. --grpc_python_out=. test.proto
</code></pre><p>Then we create the server and client using the grpc generated python file.</p><p>The server.py file:</p><pre><code class=language-python>from concurrent import futures
import base64
import time 

import test_pb2
import test_pb2_grpc

import grpc

def encoding(msg):
    return base64.a85encode(msg.encode())

class EService(test_pb2_grpc.EncodeServiceServicer):
    
    def GetEncode(self, request, context):
        return test_pb2.encodetext(enctransactionID = encoding(request.pttransactionID),
                                            encproperties = encoding(request.ptproperties),
                                            encsenderID = request.ptsenderID)

def serve():
    server = grpc.server(futures.ThreadPoolExecutor(max_workers=2))
    test_pb2_grpc.add_EncodeServiceServicer_to_server(EService(),server)
    server.add_insecure_port('[::]:22222')
    server.start()
    try:
        while True:
            time.sleep(60*60*24)
    except KeyboardInterrupt:
        server.stop(0)

if __name__ == '__main__':
    serve()
</code></pre><p>the client.py:</p><pre><code class=language-python>import grpc

import test_pb2
import test_pb2_grpc

def run():
    channel = grpc.insecure_channel('server:22222')
    stub = test_pb2_grpc.EncodeServiceStub(channel)
    response = stub.GetEncode(test_pb2.plaintext(pttransactionID = 'abcde',
    ptproperties = 'This is a plain text transaction',
    ptsenderID = 'Will smith'))
    print(&quot;Encdded service received:\n EnctransactionID:%s\n,Encproperties:%s\n,EncsenderID:%s\n&quot;%(response.enctransactionID,response.encproperties,response.encsenderID))

if __name__ == &quot;__main__&quot;:
    run()
</code></pre><p>To test the grpc on the local host, we can open two terminal. The first terminal runs the server.py and the second runs the client.py. If the client.py can return the encoded message, it proves the grpc is working properly on the local host.</p><hr><p>The Next step is to deploy this simple application on docker containers and the client and server need to be on different containers. So the encoding is considered as a microservice. To do this, we need to run two containers.</p><p>Using command <code>docker build .</code> to generate the docker images from the dockerfile. Note that you need to create an app folder and copy the &ldquo;client.py, server.py, test_pb2.py, test_pb2_grpc.py&rdquo; into this folder.</p><p>the file tree should look like this</p><pre><code>-somename
	-Dockerfile
	-app/
		-client.py
		-server.py
		-test_pb2.py
		-test_pb2_grpc.py
</code></pre><p>run <code>docker build .</code> in the directory &ldquo;somename&rdquo;. This should create a docker image. Copy the created image ID <code>image-id</code>.</p><p>Using <code>docker run -it image-id</code>, replace the <code>image-id</code> with your image ID that was created by docker build. You need to do this twice in two different command line so that you have two different container. Find the two container ID. In the following code, I use <code>container1</code> and <code>container2</code> to identify two different containers id.</p><p>The next step is to link this two containers via an network. We can use <code>docker network</code> command to achieve this.</p><p>open a third terminal and type:</p><pre><code class=language-bash>docker network create testnet
</code></pre><pre><code class=language-bash>docker network connect testnet container1 --alias client
docker network connect testnet container2 --alias server
</code></pre><p>If you have gone through the code carefully, you may wondering where was the &lsquo;&lsquo;server:22222" come from in <code>client.py</code> code. Well, here is it. The fact is we name the container2 using the network alias as &ldquo;server&rdquo; so all the containers in this network can use &ldquo;server&rdquo; to find this container. You can also use the container ID to replace &ldquo;server&rdquo;.</p><p>So now, you can run the command <code>python3 app/server.py</code> on the container2 and run <code>python3 app/client.py</code> on the container1. You should be able to see the client side successfully get the encoded message from server.</p><p>WELL DONE! Now, we have realized the comunication between two containers with grpc!</p><hr><p>That&rsquo;s all about this post. Let me know if you have any questions.</p></div></article><div class="license markdown-body"><blockquote><p>Unless otherwise noted, the content of this site is licensed under <a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a>.</p></blockquote></div></div><aside class="col-12 col-md-3 float-left sidebar"><div class="sidebar-item sidebar-pages"><h3>Pages</h3><ul><li><a href=/>Home</a></li><li><a href=/archives/>Archives</a></li><li><a href=/search/>Search</a></li></ul></div><div class="sidebar-item sidebar-links"><h3>Links</h3><ul><li><a href=https://github.com/LMJW target=_blank><span>GitHub</span></a></li></ul></div><div class="sidebar-item sidebar-tags"><h3>Tags</h3><div><span><a href=/tags/bash/>bash</a></span>
<span><a href=/tags/build/>build</a></span>
<span><a href=/tags/cli/>CLI</a></span>
<span><a href=/tags/cpp/>cpp</a></span>
<span><a href=/tags/cs/>CS</a></span>
<span><a href=/tags/deep-learning/>deep-learning</a></span>
<span><a href=/tags/docker/>docker</a></span>
<span><a href=/tags/gmp/>GMP</a></span>
<span><a href=/tags/golang/>golang</a></span>
<span><a href=/tags/grpc/>grpc</a></span>
<span><a href=/tags/kernel/>kernel</a></span>
<span><a href=/tags/key-mapping/>key-mapping</a></span>
<span><a href=/tags/kubernetes/>Kubernetes</a></span>
<span><a href=/tags/markdown-cheatsheet/>Markdown CheatSheet</a></span>
<span><a href=/tags/network/>network</a></span>
<span><a href=/tags/oop/>OOP</a></span>
<span><a href=/tags/openssl/>openssl</a></span>
<span><a href=/tags/os/>OS</a></span>
<span><a href=/tags/prost/>prost</a></span>
<span><a href=/tags/protobuf/>protobuf</a></span>
<span><a href=/tags/python/>python</a></span>
<span><a href=/tags/rust/>rust</a></span>
<span><a href=/tags/subprocess/>subprocess</a></span>
<span><a href=/tags/tonic/>tonic</a></span>
<span><a href=/tags/tool/>tool</a></span>
<span><a href=/tags/tools/>Tools</a></span></div></div><div class="sidebar-item sidebar-toc"><h3>Table of Contents</h3><nav id=TableOfContents></nav></div></aside></div><div class=btn><div class=btn-menu id=btn-menu><i class="iconfont icon-grid-sharp"></i></div><div class=btn-toggle-mode><i class="iconfont icon-contrast-sharp"></i></div><div class=btn-scroll-top><i class="iconfont icon-chevron-up-circle-sharp"></i></div></div><aside class=sidebar-mobile style=display:none><div class=sidebar-wrapper><div class="sidebar-item sidebar-pages"><h3>Pages</h3><ul><li><a href=/>Home</a></li><li><a href=/archives/>Archives</a></li><li><a href=/search/>Search</a></li></ul></div><div class="sidebar-item sidebar-links"><h3>Links</h3><ul><li><a href=https://github.com/LMJW target=_blank><span>GitHub</span></a></li></ul></div><div class="sidebar-item sidebar-tags"><h3>Tags</h3><div><span><a href=/tags/bash/>bash</a></span>
<span><a href=/tags/build/>build</a></span>
<span><a href=/tags/cli/>CLI</a></span>
<span><a href=/tags/cpp/>cpp</a></span>
<span><a href=/tags/cs/>CS</a></span>
<span><a href=/tags/deep-learning/>deep-learning</a></span>
<span><a href=/tags/docker/>docker</a></span>
<span><a href=/tags/gmp/>GMP</a></span>
<span><a href=/tags/golang/>golang</a></span>
<span><a href=/tags/grpc/>grpc</a></span>
<span><a href=/tags/kernel/>kernel</a></span>
<span><a href=/tags/key-mapping/>key-mapping</a></span>
<span><a href=/tags/kubernetes/>Kubernetes</a></span>
<span><a href=/tags/markdown-cheatsheet/>Markdown CheatSheet</a></span>
<span><a href=/tags/network/>network</a></span>
<span><a href=/tags/oop/>OOP</a></span>
<span><a href=/tags/openssl/>openssl</a></span>
<span><a href=/tags/os/>OS</a></span>
<span><a href=/tags/prost/>prost</a></span>
<span><a href=/tags/protobuf/>protobuf</a></span>
<span><a href=/tags/python/>python</a></span>
<span><a href=/tags/rust/>rust</a></span>
<span><a href=/tags/subprocess/>subprocess</a></span>
<span><a href=/tags/tonic/>tonic</a></span>
<span><a href=/tags/tool/>tool</a></span>
<span><a href=/tags/tools/>Tools</a></span></div></div><div class="sidebar-item sidebar-toc"><h3>Table of Contents</h3><nav id=TableOfContents></nav></div></div></aside></main><footer><div class="container-lg clearfix"><div class="col-12 footer"><span>&copy; 2020-2022
<a href=https://lmjw.github.io/>LMJW</a>
| <a href=https://github.com/LMJW/lmjw.github.io>Source code</a>
| Powered by <a href=https://github.com/dsrkafuu/hugo-theme-fuji/ target=_blank>Fuji-v2</a> & <a href=https://gohugo.io/ target=_blank>Hugo</a></span></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-core.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js></script>
<script defer src=/assets/js/fuji.min.js></script></body></html>